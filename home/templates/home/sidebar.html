<aside id="qeyd-sidebar" style="position:fixed; left:0; top:0; bottom:0; width:260px; background:linear-gradient(180deg,#044f8a,#033a66); border-right:1px solid rgba(0,0,0,0.06); padding:20px; box-shadow:2px 0 18px rgba(2,24,47,0.12); z-index:60; overflow:auto;">
    <div style="display:flex; flex-direction:column; gap:16px; height:100%;">
        <!-- Logo -->
        <a href="{% url 'welcome' %}" style="text-decoration:none; color:inherit; display:flex; align-items:center; gap:12px;">
            <div style="width:44px; height:44px; border-radius:10px; background:rgba(255,255,255,0.06); display:flex; align-items:center; justify-content:center;">
                <svg width="28" height="28" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                    <rect x="2" y="3" width="14" height="18" rx="2" fill="#044f8a" />
                    <path d="M16.5 3.5l4 4L10 18l-4 1 1-4L16.5 3.5z" fill="#ffffff" />
                </svg>
            </div>
            <div style="font-weight:900; color:#ffffff; font-size:18px; letter-spacing:0.2px">QeydLab</div>
        </a>

        <!-- Navigation -->
        <nav style="margin-top:8px; display:flex; flex-direction:column; gap:8px;">
            <a href="{% url 'menu_page' %}" style="display:flex; align-items:center; padding:10px 12px; border-radius:8px; color:#eaf6ff; text-decoration:none; font-weight:700; background:transparent">Media</a>
            
            <!-- Müştərilər -->
            <div>
                <a href="#" id="customersToggleLink" style="display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-radius:8px; color:#e8f6ff; font-weight:700; text-decoration:none; background:transparent">
                    <span>Müştərilər</span>
                    <span id="customersAccordionIcon" style="font-size:12px; transition:transform 0.2s;">►</span>
                </a>
                <div id="customersMenu" style="display:none; margin-top:8px; display:flex; flex-direction:column; gap:6px; padding-left:6px;">
                    <a href="{% url 'notes_list' %}" style="padding:8px 10px; border-radius:8px; color:#dbeeff; text-decoration:none; background:transparent">Yaradılan qeydlər</a>
                </div>
            </div>

            <!-- Administrator -->
            <div>
                <a href="#" id="adminToggleLink" style="display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-radius:8px; color:#eaf6ff; text-decoration:none; font-weight:700; background:transparent">
                    <span>Administrator</span>
                    <span id="adminAccordionIcon" style="font-size:12px; transition:transform 0.2s;">►</span>
                </a>
                <div id="adminMenu" style="display:none; margin-top:8px; display:flex; flex-direction:column; gap:6px; padding-left:6px;">
                    <a href="{% url 'users_list' %}" style="padding:8px 10px; border-radius:8px; color:#dbeeff; text-decoration:none;">Userlər</a>
                </div>
            </div>
        </nav>

        <!-- Dark Mode Toggle -->
        <div style="margin-top:auto; padding-top:12px; border-top:1px solid rgba(255,255,255,0.06);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; color:#ffffff;">Dark Mode</div>
            <label class="switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider">
                    <span class="star star_1"></span>
                    <span class="star star_2"></span>
                    <span class="star star_3"></span>
                    <span class="cloud"></span>
                </span>
            </label>
        </div>

        <!-- Logged user -->
        <div style="margin-top:12px; font-size:12px; color:rgba(255,255,255,0.7);">Logged as</div>
        <div style="font-weight:700; color:#ffffff; margin-top:6px">{{ request.user.username|default:request.session.username|default:'Qonaq' }}</div>
    </div>
</aside>

<style>
    .main-with-sidebar { margin-left: 280px; width: calc(100% - 300px); padding: 18px 20px; box-sizing: border-box; }
    .main-with-sidebar .box { max-width: none; width:100%; }
    @media (max-width:900px){
        #qeyd-sidebar{ position:relative; width:100%; height:auto; box-shadow:none; border-right:none }
        .main-with-sidebar{ margin-left:0; width:100%; padding:12px }
    }

    /* Dark Mode Styles */
    body.dark-mode { background-color: #121212; color: #e0e0e0; }
    body.dark-mode a { color: #a0c4ff; }
    body.dark-mode .box { background-color: #1e1e1e; color:#e0e0e0; }
    body.dark-mode #qeyd-sidebar { background: linear-gradient(180deg,#0d1b2a,#1b263b); }
    body.dark-mode input, body.dark-mode textarea { background-color: #2b2b2b; color:#e0e0e0; border:1px solid #555; }
    body.dark-mode .btn { background-color: #3a86ff; color:#fff; }
    body.dark-mode .back-link { color:#ccc; }

    /* Toggle Switch from Uiverse.io */
    .switch { font-size: 17px; position: relative; display: inline-block; width: 4em; height: 2.2em; border-radius: 30px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #2a2a2a; transition: 0.4s; border-radius: 30px; overflow: hidden; }
    .slider:before { position: absolute; content: ""; height: 1.2em; width: 1.2em; border-radius: 20px; left: 0.5em; bottom: 0.5em; transition: 0.4s; transition-timing-function: cubic-bezier(0.81, -0.04, 0.38, 1.5); box-shadow: inset 8px -4px 0px 0px #fff; }
    .switch input:checked + .slider { background-color: #00a6ff; }
    .switch input:checked + .slider:before { transform: translateX(1.8em); box-shadow: inset 15px -4px 0px 15px #ffcf48; }

    .star { background-color: #fff; border-radius: 50%; position: absolute; width: 5px; transition: all 0.4s; height: 5px; }
    .star_1 { left: 2.5em; top: 0.5em; }
    .star_2 { left: 2.2em; top: 1.2em; }
    .star_3 { left: 3em; top: 0.9em; }
    .switch input:checked ~ .slider .star { opacity: 0; }

    .cloud { width: 3.5em; position: absolute; bottom: -1.4em; left: -1.1em; opacity: 0; transition: all 0.4s; }
    .switch input:checked ~ .slider .cloud { opacity: 1; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function(){
    // Accordion
    function setupAccordion(toggleId, menuId, iconId){
        const toggle = document.getElementById(toggleId);
        const menu = document.getElementById(menuId);
        const icon = document.getElementById(iconId);
        if(toggle && menu && icon){
            toggle.addEventListener('click', function(e){
                e.preventDefault();
                const isOpen = menu.style.display === 'flex';
                menu.style.display = isOpen ? 'none' : 'flex';
                icon.textContent = isOpen ? '►' : '▼';
            });
            if(menu.querySelector('a[href="'+window.location.pathname+'"]')){
                menu.style.display = 'flex';
                icon.textContent = '▼';
            }
        }
    }
    setupAccordion('adminToggleLink','adminMenu','adminAccordionIcon');
    setupAccordion('customersToggleLink','customersMenu','customersAccordionIcon');

    // Dark Mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
        darkModeToggle.checked = true;
    }
    darkModeToggle.addEventListener('change', function(){
        if(this.checked){
            document.body.classList.add('dark-mode');
            localStorage.setItem('darkMode','enabled');
        } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('darkMode','disabled');
        }
    });
});
</script>
